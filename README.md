# Общая структура проекта

## Типы виртуальных машин:
  
- DB (MongoDB/RabbitMQ)
- APP (UI/Crawler)
- GitLab (Server/Runner)
- Monitoring (Prometheus)

# Описание

Будет 2е среды, Stage - для разработки и Prod - для продуктивной среды

Для каждой среды будет создаваться 3 ВМ: DB, APP, Monitoring.

При помощи Packer будет подготавливаться шаблон ВМ для каждого из типов ВМ.

Terraform будет создавать ВМ каждого типа, из подготовленных Packer`ом шаблонов, для каждой среды.

Сервисный пользователь, который подготавливает ВМ именуется r2d2 =D.

1. Четыре машины в GCP:
- 1.1 App, машина на которую клонируются два репозитория: ui и crawler.
- 1.2 DB, машина с Reddit и MongoDB.
- 1.3 GitLab, машина для CI\CD.
- 1.4 Monitoring, Prometheus.

2. Структура папок
- Packer - Создание готового имаджа с необходимым софтов для терраформа
- Terraform - Описание инфраструктуры проекта
- Ansible - Плейбуки для автоматического деплоя проекта
	
3. 

# Развертывание проекта

1. Нужно создать шаблоны ВМ
- 1.1. для этого нужно пройти в директорию Packer
- 1.1.1. создать файл variables.json из примера variables.json.example
- 1.1.2. запустить процесс сборки шаблонов, выполнив комаду packer build -var-file=variables.json db.json и packer build -var-file=variables.json docker.json
- 1.2. Далее нужно пройти в диреторию Terraform из корня репозитория
- 1.2.1. В проекте настроено удаленное хранение состояния инфраструктуры в GCP bucket, поэтому нужно или руками, или, также при помощи Terraform, создать buket
- 1.2.2. Для примера разврнем среду Stage, для этого нужно пройти в директорию stage и выполнить команду Terraform apply
- 1.2.3. По итогу Terraform покажет внешние и внутренние адреса ВМ их нужно запомнить или записать для дальнейшей работы
- 1.3. Теперь нужно перейти в директорию Ansible из корня репозитория
- 1.3.1. Для работы Ansible нужно в имеющийся inventory файл подставить IP адреса, которые вывел Terraform, под каждый из типов серверов
- 1.3.2. 
